    <!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="ExDoc v0.18.1">
    <title>Phoenix.Channel – Phoenix v1.4.0-dev</title>
    <link rel="stylesheet" href="dist/app-c922dbe7ef.css" />
    
    <script src="dist/sidebar_items-44310d1b40.js"></script>
    
    <link rel="stylesheet" href="dist/ex_doc_makeup-css.css"/>
    
    
  </head>
  <body data-type="modules">
    <script>try { if(localStorage.getItem('night-mode')) document.body.className += ' night-mode'; } catch (e) { }</script>

    <div class="main">
<button class="sidebar-toggle">
  <span class="icon-menu" aria-hidden="true"></span>
  <span class="sr-only">Toggle Sidebar</span>
</button>
<section class="sidebar">

  
  <a href="http://www.phoenixframework.org" class="sidebar-projectLink">
    <div class="sidebar-projectDetails">
      <h1 class="sidebar-projectName">
        Phoenix
      </h1>
      <h2 class="sidebar-projectVersion">
        v1.4.0-dev
      </h2>
    </div>
    
      <img src="assets/logo.png" alt="Phoenix" class="sidebar-projectImage">
    
  </a>

  <form class="sidebar-search" action="search.html">
    <button type="submit" class="search-button">
      <span class="icon-search" aria-hidden="true"></span>
    </button>
    <input name="q" type="text" id="search-list" class="search-input" placeholder="search" aria-label="Search" autocomplete="off" />
  </form>

  <ul class="sidebar-listNav">
    <li><a id="extras-list" href="#full-list">GUIDES</a></li>

    
      <li><a id="modules-list" href="#full-list">Modules</a></li>
    

    
      <li><a id="exceptions-list" href="#full-list">Exceptions</a></li>
    

    
      <li><a id="tasks-list" href="#full-list">Mix Tasks</a></li>
    
  </ul>
  <div class="gradient"></div>
  <ul id="full-list" class="sidebar-fullList"></ul>
</section>

<section class="content">
  <div class="content-outer">
    <div id="content" class="content-inner">


      <h1>
        <small class="visible-xs">Phoenix v1.4.0-dev</small>
        Phoenix.Channel <small>behaviour</small>
        
          <a href="https://github.com/phoenixframework/phoenix/blob/v1.4.0-dev/lib/phoenix/channel.ex#L1" title="View Source" class="view-source" rel="help">
            <span class="icon-code" aria-hidden="true"></span>
            <span class="sr-only">View Source</span>
          </a>
        
      </h1>

      
        <section id="moduledoc">
          <p>Defines a Phoenix Channel.</p>
<p>Channels provide a means for bidirectional communication from clients that
integrate with the <a href="https://hexdocs.pm/phoenix_pubsub/1.0.1/Phoenix.PubSub.html"><code class="inline">Phoenix.PubSub</code></a> layer for soft-realtime functionality.</p>
<h2 id="module-topics-callbacks" class="section-heading">
  <a href="#module-topics-callbacks" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Topics &amp; Callbacks
</h2>

<p>Every time you join a channel, you need to choose which particular topic you
want to listen to. The topic is just an identifier, but by convention it is
often made of two parts: <code class="inline">&quot;topic:subtopic&quot;</code>. Using the <code class="inline">&quot;topic:subtopic&quot;</code>
approach pairs nicely with the <a href="Phoenix.Socket.html#channel/2"><code class="inline">Phoenix.Socket.channel/2</code></a> allowing you to
match on all topics starting with a given prefix:</p>
<pre><code class="nohighlight makeup"><span class="n">channel</span><span class="w"> </span><span class="s2">&quot;room:*&quot;</span><span class="p">,</span><span class="w"> </span><span class="nc">MyApp.RoomChannel</span></code></pre>
<p>Any topic coming into the router with the <code class="inline">&quot;room:&quot;</code> prefix would dispatch
to <code class="inline">MyApp.RoomChannel</code> in the above example. Topics can also be pattern
matched in your channels’ <code class="inline">join/3</code> callback to pluck out the scoped pattern:</p>
<pre><code class="nohighlight makeup"><span class="c1"># handles the special `&quot;lobby&quot;` subtopic
</span><span class="kd">def</span><span class="w"> </span><span class="nf">join</span><span class="p" data-group-id="1989">(</span><span class="s2">&quot;room:lobby&quot;</span><span class="p">,</span><span class="w"> </span><span class="bp">_auth_message</span><span class="p">,</span><span class="w"> </span><span class="n">socket</span><span class="p" data-group-id="1989">)</span><span class="w"> </span><span class="k" data-group-id="2024">do</span><span class="w">
  </span><span class="p" data-group-id="2018">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="n">socket</span><span class="p" data-group-id="2018">}</span><span class="w">
</span><span class="k" data-group-id="2024">end</span><span class="w">

</span><span class="c1"># handles any other subtopic as the room ID, for example `&quot;room:12&quot;`, `&quot;room:34&quot;`
</span><span class="kd">def</span><span class="w"> </span><span class="nf">join</span><span class="p" data-group-id="2091">(</span><span class="s2">&quot;room:&quot;</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="n">room_id</span><span class="p">,</span><span class="w"> </span><span class="n">auth_message</span><span class="p">,</span><span class="w"> </span><span class="n">socket</span><span class="p" data-group-id="2091">)</span><span class="w"> </span><span class="k" data-group-id="2116">do</span><span class="w">
  </span><span class="p" data-group-id="2109">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="n">socket</span><span class="p" data-group-id="2109">}</span><span class="w">
</span><span class="k" data-group-id="2116">end</span></code></pre>
<h2 id="module-authorization" class="section-heading">
  <a href="#module-authorization" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Authorization
</h2>

<p>Clients must join a channel to send and receive PubSub events on that channel.
Your channels must implement a <code class="inline">join/3</code> callback that authorizes the socket
for the given topic. For example, you could check if the user is allowed to
join that particular room.</p>
<p>To authorize a socket in <code class="inline">join/3</code>, return <code class="inline">{:ok, socket}</code>.
To refuse authorization in <code class="inline">join/3</code>, return <code class="inline">{:error, reply}</code>.</p>
<h2 id="module-incoming-events" class="section-heading">
  <a href="#module-incoming-events" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Incoming Events
</h2>

<p>After a client has successfully joined a channel, incoming events from the
client are routed through the channel’s <code class="inline">handle_in/3</code> callbacks. Within these
callbacks, you can perform any action. Typically you’ll either forward a
message to all listeners with <a href="#broadcast!/3"><code class="inline">broadcast!/3</code></a>, or push a message directly down
the socket with <a href="#push/3"><code class="inline">push/3</code></a>. Incoming callbacks must return the <code class="inline">socket</code> to
maintain ephemeral state.</p>
<p>Here’s an example of receiving an incoming <code class="inline">&quot;new_msg&quot;</code> event from one client,
and broadcasting the message to all topic subscribers for this socket.</p>
<pre><code class="nohighlight makeup"><span class="kd">def</span><span class="w"> </span><span class="nf">handle_in</span><span class="p" data-group-id="2037">(</span><span class="s2">&quot;new_msg&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2029">%{</span><span class="s2">&quot;uid&quot;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">uid</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;body&quot;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">body</span><span class="p" data-group-id="2029">}</span><span class="p">,</span><span class="w"> </span><span class="n">socket</span><span class="p" data-group-id="2037">)</span><span class="w"> </span><span class="k" data-group-id="2125">do</span><span class="w">
  </span><span class="n">broadcast!</span><span class="w"> </span><span class="n">socket</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;new_msg&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2099">%{</span><span class="ss">uid</span><span class="p">:</span><span class="w"> </span><span class="n">uid</span><span class="p">,</span><span class="w"> </span><span class="ss">body</span><span class="p">:</span><span class="w"> </span><span class="n">body</span><span class="p" data-group-id="2099">}</span><span class="w">
  </span><span class="p" data-group-id="2119">{</span><span class="ss">:noreply</span><span class="p">,</span><span class="w"> </span><span class="n">socket</span><span class="p" data-group-id="2119">}</span><span class="w">
</span><span class="k" data-group-id="2125">end</span></code></pre>
<p>You can also push a message directly down the socket:</p>
<pre><code class="nohighlight makeup"><span class="c1"># client asks for their current rank, push sent directly as a new event.
</span><span class="kd">def</span><span class="w"> </span><span class="nf">handle_in</span><span class="p" data-group-id="1996">(</span><span class="s2">&quot;current_rank&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">socket</span><span class="p" data-group-id="1996">)</span><span class="w"> </span><span class="k" data-group-id="2117">do</span><span class="w">
  </span><span class="n">push</span><span class="w"> </span><span class="n">socket</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;current_rank&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2094">%{</span><span class="ss">val</span><span class="p">:</span><span class="w"> </span><span class="nc">Game</span><span class="o">.</span><span class="n">get_rank</span><span class="p" data-group-id="2093">(</span><span class="n">socket</span><span class="o">.</span><span class="n">assigns</span><span class="p" data-group-id="2092">[</span><span class="ss">:user</span><span class="p" data-group-id="2092">]</span><span class="p" data-group-id="2093">)</span><span class="p" data-group-id="2094">}</span><span class="w">
  </span><span class="p" data-group-id="2112">{</span><span class="ss">:noreply</span><span class="p">,</span><span class="w"> </span><span class="n">socket</span><span class="p" data-group-id="2112">}</span><span class="w">
</span><span class="k" data-group-id="2117">end</span></code></pre>
<h2 id="module-replies" class="section-heading">
  <a href="#module-replies" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Replies
</h2>

<p>In addition to pushing messages out when you receive a <code class="inline">handle_in</code> event,
you can also reply directly to a client event for request/response style
messaging. This is useful when a client must know the result of an operation
or to simply ack messages.</p>
<p>For example, imagine creating a resource and replying with the created record:</p>
<pre><code class="nohighlight makeup"><span class="kd">def</span><span class="w"> </span><span class="nf">handle_in</span><span class="p" data-group-id="1979">(</span><span class="s2">&quot;create:post&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">attrs</span><span class="p">,</span><span class="w"> </span><span class="n">socket</span><span class="p" data-group-id="1979">)</span><span class="w"> </span><span class="k" data-group-id="2244">do</span><span class="w">
  </span><span class="n">changeset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Post</span><span class="o">.</span><span class="n">changeset</span><span class="p" data-group-id="2035">(</span><span class="p" data-group-id="2025">%</span><span class="nc" data-group-id="2025">Post</span><span class="p" data-group-id="2025">{}</span><span class="p">,</span><span class="w"> </span><span class="n">attrs</span><span class="p" data-group-id="2035">)</span><span class="w">

  </span><span class="k">if</span><span class="w"> </span><span class="n">changeset</span><span class="o">.</span><span class="n">valid?</span><span class="w"> </span><span class="k" data-group-id="2243">do</span><span class="w">
    </span><span class="n">post</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Repo</span><span class="o">.</span><span class="n">insert!</span><span class="p" data-group-id="2090">(</span><span class="n">changeset</span><span class="p" data-group-id="2090">)</span><span class="w">
    </span><span class="n">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">MyApp.PostView</span><span class="o">.</span><span class="n">render</span><span class="p" data-group-id="2140">(</span><span class="s2">&quot;show.json&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2139">%{</span><span class="ss">post</span><span class="p">:</span><span class="w"> </span><span class="n">post</span><span class="p" data-group-id="2139">}</span><span class="p" data-group-id="2140">)</span><span class="w">
    </span><span class="p" data-group-id="2180">{</span><span class="ss">:reply</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2167">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="n">response</span><span class="p" data-group-id="2167">}</span><span class="p">,</span><span class="w"> </span><span class="n">socket</span><span class="p" data-group-id="2180">}</span><span class="w">
  </span><span class="k" data-group-id="2243">else</span><span class="w">
    </span><span class="n">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">MyApp.ChangesetView</span><span class="o">.</span><span class="n">render</span><span class="p" data-group-id="2222">(</span><span class="s2">&quot;errors.json&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2221">%{</span><span class="ss">changeset</span><span class="p">:</span><span class="w"> </span><span class="n">changeset</span><span class="p" data-group-id="2221">}</span><span class="p" data-group-id="2222">)</span><span class="w">
    </span><span class="p" data-group-id="2239">{</span><span class="ss">:reply</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2237">{</span><span class="ss">:error</span><span class="p">,</span><span class="w"> </span><span class="n">response</span><span class="p" data-group-id="2237">}</span><span class="p">,</span><span class="w"> </span><span class="n">socket</span><span class="p" data-group-id="2239">}</span><span class="w">
  </span><span class="k" data-group-id="2243">end</span><span class="w">
</span><span class="k" data-group-id="2244">end</span></code></pre>
<p>Alternatively, you may just want to ack the status of the operation:</p>
<pre><code class="nohighlight makeup"><span class="kd">def</span><span class="w"> </span><span class="nf">handle_in</span><span class="p" data-group-id="1981">(</span><span class="s2">&quot;create:post&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">attrs</span><span class="p">,</span><span class="w"> </span><span class="n">socket</span><span class="p" data-group-id="1981">)</span><span class="w"> </span><span class="k" data-group-id="2133">do</span><span class="w">
  </span><span class="n">changeset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Post</span><span class="o">.</span><span class="n">changeset</span><span class="p" data-group-id="2036">(</span><span class="p" data-group-id="2026">%</span><span class="nc" data-group-id="2026">Post</span><span class="p" data-group-id="2026">{}</span><span class="p">,</span><span class="w"> </span><span class="n">attrs</span><span class="p" data-group-id="2036">)</span><span class="w">

  </span><span class="k">if</span><span class="w"> </span><span class="n">changeset</span><span class="o">.</span><span class="n">valid?</span><span class="w"> </span><span class="k" data-group-id="2131">do</span><span class="w">
    </span><span class="nc">Repo</span><span class="o">.</span><span class="n">insert!</span><span class="p" data-group-id="2088">(</span><span class="n">changeset</span><span class="p" data-group-id="2088">)</span><span class="w">
    </span><span class="p" data-group-id="2111">{</span><span class="ss">:reply</span><span class="p">,</span><span class="w"> </span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="n">socket</span><span class="p" data-group-id="2111">}</span><span class="w">
  </span><span class="k" data-group-id="2131">else</span><span class="w">
    </span><span class="p" data-group-id="2129">{</span><span class="ss">:reply</span><span class="p">,</span><span class="w"> </span><span class="ss">:error</span><span class="p">,</span><span class="w"> </span><span class="n">socket</span><span class="p" data-group-id="2129">}</span><span class="w">
  </span><span class="k" data-group-id="2131">end</span><span class="w">
</span><span class="k" data-group-id="2133">end</span></code></pre>
<h2 id="module-intercepting-outgoing-events" class="section-heading">
  <a href="#module-intercepting-outgoing-events" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Intercepting Outgoing Events
</h2>

<p>When an event is broadcasted with <a href="#broadcast/3"><code class="inline">broadcast/3</code></a>, each channel subscriber can
choose to intercept the event and have their <code class="inline">handle_out/3</code> callback triggered.
This allows the event’s payload to be customized on a socket by socket basis
to append extra information, or conditionally filter the message from being
delivered. If the event is not intercepted with <a href="Phoenix.Channel.html#intercept/1"><code class="inline">Phoenix.Channel.intercept/1</code></a>,
then the message is pushed directly to the client:</p>
<pre><code class="nohighlight makeup"><span class="n">intercept</span><span class="w"> </span><span class="p" data-group-id="1971">[</span><span class="s2">&quot;new_msg&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;user_joined&quot;</span><span class="p" data-group-id="1971">]</span><span class="w">

</span><span class="c1"># for every socket subscribing to this topic, append an `is_editable`
# value for client metadata.
</span><span class="kd">def</span><span class="w"> </span><span class="nf">handle_out</span><span class="p" data-group-id="2030">(</span><span class="s2">&quot;new_msg&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">msg</span><span class="p">,</span><span class="w"> </span><span class="n">socket</span><span class="p" data-group-id="2030">)</span><span class="w"> </span><span class="k" data-group-id="2161">do</span><span class="w">
  </span><span class="n">push</span><span class="w"> </span><span class="n">socket</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;new_msg&quot;</span><span class="p">,</span><span class="w"> </span><span class="nc">Map</span><span class="o">.</span><span class="n">merge</span><span class="p" data-group-id="2145">(</span><span class="n">msg</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="2144">%{</span><span class="ss">is_editable</span><span class="p">:</span><span class="w"> </span><span class="nc">User</span><span class="o">.</span><span class="n">can_edit_message?</span><span class="p" data-group-id="2143">(</span><span class="n">socket</span><span class="o">.</span><span class="n">assigns</span><span class="p" data-group-id="2136">[</span><span class="ss">:user</span><span class="p" data-group-id="2136">]</span><span class="p">,</span><span class="w"> </span><span class="n">msg</span><span class="p" data-group-id="2143">)</span><span class="p" data-group-id="2144">}</span><span class="w">
  </span><span class="p" data-group-id="2145">)</span><span class="w">
  </span><span class="p" data-group-id="2156">{</span><span class="ss">:noreply</span><span class="p">,</span><span class="w"> </span><span class="n">socket</span><span class="p" data-group-id="2156">}</span><span class="w">
</span><span class="k" data-group-id="2161">end</span><span class="w">

</span><span class="c1"># do not send broadcasted `&quot;user_joined&quot;` events if this socket's user
# is ignoring the user who joined.
</span><span class="kd">def</span><span class="w"> </span><span class="nf">handle_out</span><span class="p" data-group-id="2209">(</span><span class="s2">&quot;user_joined&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">msg</span><span class="p">,</span><span class="w"> </span><span class="n">socket</span><span class="p" data-group-id="2209">)</span><span class="w"> </span><span class="k" data-group-id="2264">do</span><span class="w">
  </span><span class="k">unless</span><span class="w"> </span><span class="nc">User</span><span class="o">.</span><span class="n">ignoring?</span><span class="p" data-group-id="2242">(</span><span class="n">socket</span><span class="o">.</span><span class="n">assigns</span><span class="p" data-group-id="2236">[</span><span class="ss">:user</span><span class="p" data-group-id="2236">]</span><span class="p">,</span><span class="w"> </span><span class="n">msg</span><span class="o">.</span><span class="n">user_id</span><span class="p" data-group-id="2242">)</span><span class="w"> </span><span class="k" data-group-id="2256">do</span><span class="w">
    </span><span class="n">push</span><span class="w"> </span><span class="n">socket</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;user_joined&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">msg</span><span class="w">
  </span><span class="k" data-group-id="2256">end</span><span class="w">
  </span><span class="p" data-group-id="2262">{</span><span class="ss">:noreply</span><span class="p">,</span><span class="w"> </span><span class="n">socket</span><span class="p" data-group-id="2262">}</span><span class="w">
</span><span class="k" data-group-id="2264">end</span></code></pre>
<h2 id="module-broadcasting-to-an-external-topic" class="section-heading">
  <a href="#module-broadcasting-to-an-external-topic" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Broadcasting to an external topic
</h2>

<p>In some cases, you will want to broadcast messages without the context of
a <code class="inline">socket</code>. This could be for broadcasting from within your channel to an
external topic, or broadcasting from elsewhere in your application like a
controller or another process. Such can be done via your endpoint:</p>
<pre><code class="nohighlight makeup"><span class="c1"># within channel
</span><span class="kd">def</span><span class="w"> </span><span class="nf">handle_in</span><span class="p" data-group-id="2056">(</span><span class="s2">&quot;new_msg&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2044">%{</span><span class="s2">&quot;uid&quot;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">uid</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;body&quot;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">body</span><span class="p" data-group-id="2044">}</span><span class="p">,</span><span class="w"> </span><span class="n">socket</span><span class="p" data-group-id="2056">)</span><span class="w"> </span><span class="k" data-group-id="2211">do</span><span class="w">
  </span><span class="o">...</span><span class="w">
  </span><span class="n">broadcast_from!</span><span class="w"> </span><span class="n">socket</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;new_msg&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2128">%{</span><span class="ss">uid</span><span class="p">:</span><span class="w"> </span><span class="n">uid</span><span class="p">,</span><span class="w"> </span><span class="ss">body</span><span class="p">:</span><span class="w"> </span><span class="n">body</span><span class="p" data-group-id="2128">}</span><span class="w">
  </span><span class="nc">MyApp.Endpoint</span><span class="o">.</span><span class="n">broadcast_from!</span><span class="w"> </span><span class="n">self</span><span class="p" data-group-id="2142">()</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;room:superadmin&quot;</span><span class="p">,</span><span class="w">
    </span><span class="s2">&quot;new_msg&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2199">%{</span><span class="ss">uid</span><span class="p">:</span><span class="w"> </span><span class="n">uid</span><span class="p">,</span><span class="w"> </span><span class="ss">body</span><span class="p">:</span><span class="w"> </span><span class="n">body</span><span class="p" data-group-id="2199">}</span><span class="w">
  </span><span class="p" data-group-id="2210">{</span><span class="ss">:noreply</span><span class="p">,</span><span class="w"> </span><span class="n">socket</span><span class="p" data-group-id="2210">}</span><span class="w">
</span><span class="k" data-group-id="2211">end</span><span class="w">

</span><span class="c1"># within controller
</span><span class="kd">def</span><span class="w"> </span><span class="nf">create</span><span class="p" data-group-id="2223">(</span><span class="n">conn</span><span class="p">,</span><span class="w"> </span><span class="n">params</span><span class="p" data-group-id="2223">)</span><span class="w"> </span><span class="k" data-group-id="2293">do</span><span class="w">
  </span><span class="o">...</span><span class="w">
  </span><span class="nc">MyApp.Endpoint</span><span class="o">.</span><span class="n">broadcast!</span><span class="w"> </span><span class="s2">&quot;room:&quot;</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="n">rid</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;new_msg&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2259">%{</span><span class="ss">uid</span><span class="p">:</span><span class="w"> </span><span class="n">uid</span><span class="p">,</span><span class="w"> </span><span class="ss">body</span><span class="p">:</span><span class="w"> </span><span class="n">body</span><span class="p" data-group-id="2259">}</span><span class="w">
  </span><span class="nc">MyApp.Endpoint</span><span class="o">.</span><span class="n">broadcast!</span><span class="w"> </span><span class="s2">&quot;room:superadmin&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;new_msg&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2282">%{</span><span class="ss">uid</span><span class="p">:</span><span class="w"> </span><span class="n">uid</span><span class="p">,</span><span class="w"> </span><span class="ss">body</span><span class="p">:</span><span class="w"> </span><span class="n">body</span><span class="p" data-group-id="2282">}</span><span class="w">
  </span><span class="n">redirect</span><span class="w"> </span><span class="n">conn</span><span class="p">,</span><span class="w"> </span><span class="ss">to</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/&quot;</span><span class="w">
</span><span class="k" data-group-id="2293">end</span></code></pre>
<h2 id="module-terminate" class="section-heading">
  <a href="#module-terminate" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Terminate
</h2>

<p>On termination, the channel callback <code class="inline">terminate/2</code> will be invoked with
the error reason and the socket.</p>
<p>If we are terminating because the client left, the reason will be
<code class="inline">{:shutdown, :left}</code>. Similarly, if we are terminating because the
client connection was closed, the reason will be <code class="inline">{:shutdown, :closed}</code>.</p>
<p>If any of the callbacks return a <code class="inline">:stop</code> tuple, it will also
trigger terminate with the reason given in the tuple.</p>
<p><code class="inline">terminate/2</code>, however, won’t be invoked in case of errors nor in
case of exits. This is the same behaviour as you find in Elixir
abstractions like <a href="https://hexdocs.pm/elixir/GenServer.html"><code class="inline">GenServer</code></a> and others. Typically speaking, if you
want to clean something up, it is better to monitor your channel
process and do the clean up from another process.  Similar to GenServer,
it would also be possible <code class="inline">:trap_exit</code> to guarantee that <code class="inline">terminate/2</code>
is invoked. This practice is not encouraged though.</p>
<h2 id="module-exit-reasons-when-stopping-a-channel" class="section-heading">
  <a href="#module-exit-reasons-when-stopping-a-channel" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Exit reasons when stopping a channel
</h2>

<p>When the channel callbacks return a <code class="inline">:stop</code> tuple, such as:</p>
<pre><code class="nohighlight makeup"><span class="p" data-group-id="1967">{</span><span class="ss">:stop</span><span class="p">,</span><span class="w"> </span><span class="ss">:shutdown</span><span class="p">,</span><span class="w"> </span><span class="n">socket</span><span class="p" data-group-id="1967">}</span><span class="w">
</span><span class="p" data-group-id="2014">{</span><span class="ss">:stop</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2000">{</span><span class="ss">:error</span><span class="p">,</span><span class="w"> </span><span class="ss">:enoent</span><span class="p" data-group-id="2000">}</span><span class="p">,</span><span class="w"> </span><span class="n">socket</span><span class="p" data-group-id="2014">}</span></code></pre>
<p>the second argument is the exit reason, which follows the same behaviour as
standard <a href="https://hexdocs.pm/elixir/GenServer.html"><code class="inline">GenServer</code></a> exits.</p>
<p>You have three options to choose from when shutting down a channel:</p>
<ul>
<li><p><code class="inline">:normal</code> - in such cases, the exit won’t be logged, there is no restart
in transient mode, and linked processes do not exit</p>
</li>
<li><p><code class="inline">:shutdown</code> or <code class="inline">{:shutdown, term}</code> - in such cases, the exit won’t be
logged, there is no restart in transient mode, and linked processes exit
with the same reason unless they’re trapping exits</p>
</li>
<li><p>any other term - in such cases, the exit will be logged, there are
restarts in transient mode, and linked processes exit with the same reason
unless they’re trapping exits</p>
</li>
</ul>
<h2 id="module-subscribing-to-external-topics" class="section-heading">
  <a href="#module-subscribing-to-external-topics" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Subscribing to external topics
</h2>

<p>Sometimes you may need to programmatically subscribe a socket to external
topics in addition to the the internal <code class="inline">socket.topic</code>. For example,
imagine you have a bidding system where a remote client dynamically sets
preferences on products they want to receive bidding notifications on.
Instead of requiring a unique channel process and topic per
preference, a more efficient and simple approach would be to subscribe a
single channel to relevant notifications via your endpoint. For example:</p>
<pre><code class="nohighlight makeup"><span class="kd">defmodule</span><span class="w"> </span><span class="nc">MyApp.Endpoint.NotificationChannel</span><span class="w"> </span><span class="k" data-group-id="2356">do</span><span class="w">
  </span><span class="kn">use</span><span class="w"> </span><span class="nc">Phoenix.Channel</span><span class="w">

  </span><span class="kd">def</span><span class="w"> </span><span class="nf">join</span><span class="p" data-group-id="2059">(</span><span class="s2">&quot;notification:&quot;</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="n">user_id</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2047">%{</span><span class="s2">&quot;ids&quot;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">ids</span><span class="p" data-group-id="2047">}</span><span class="p">,</span><span class="w"> </span><span class="n">socket</span><span class="p" data-group-id="2059">)</span><span class="w"> </span><span class="k" data-group-id="2171">do</span><span class="w">
    </span><span class="n">topics</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">product_id</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ids</span><span class="p">,</span><span class="w"> </span><span class="ss">do</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;product:</span><span class="si" data-group-id="2126">#{</span><span class="n">product_id</span><span class="si" data-group-id="2126">}</span><span class="s2">&quot;</span><span class="w">

    </span><span class="p" data-group-id="2165">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="n">socket</span><span class="w">
          </span><span class="o">|&gt;</span><span class="w"> </span><span class="n">assign</span><span class="p" data-group-id="2150">(</span><span class="ss">:topics</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2149">[]</span><span class="p" data-group-id="2150">)</span><span class="w">
          </span><span class="o">|&gt;</span><span class="w"> </span><span class="n">put_new_topics</span><span class="p" data-group-id="2164">(</span><span class="n">topics</span><span class="p" data-group-id="2164">)</span><span class="p" data-group-id="2165">}</span><span class="w">
  </span><span class="k" data-group-id="2171">end</span><span class="w">

  </span><span class="kd">def</span><span class="w"> </span><span class="nf">handle_in</span><span class="p" data-group-id="2219">(</span><span class="s2">&quot;watch&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2214">%{</span><span class="s2">&quot;product_id&quot;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">id</span><span class="p" data-group-id="2214">}</span><span class="p">,</span><span class="w"> </span><span class="n">socket</span><span class="p" data-group-id="2219">)</span><span class="w"> </span><span class="k" data-group-id="2253">do</span><span class="w">
    </span><span class="p" data-group-id="2252">{</span><span class="ss">:reply</span><span class="p">,</span><span class="w"> </span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="n">put_new_topics</span><span class="p" data-group-id="2251">(</span><span class="n">socket</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2250">[</span><span class="s2">&quot;product:</span><span class="si" data-group-id="2249">#{</span><span class="n">id</span><span class="si" data-group-id="2249">}</span><span class="s2">&quot;</span><span class="p" data-group-id="2250">]</span><span class="p" data-group-id="2251">)</span><span class="p" data-group-id="2252">}</span><span class="w">
  </span><span class="k" data-group-id="2253">end</span><span class="w">

  </span><span class="kd">def</span><span class="w"> </span><span class="nf">handle_in</span><span class="p" data-group-id="2275">(</span><span class="s2">&quot;unwatch&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2271">%{</span><span class="s2">&quot;product_id&quot;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">id</span><span class="p" data-group-id="2271">}</span><span class="p">,</span><span class="w"> </span><span class="n">socket</span><span class="p" data-group-id="2275">)</span><span class="w"> </span><span class="k" data-group-id="2292">do</span><span class="w">
    </span><span class="p" data-group-id="2291">{</span><span class="ss">:reply</span><span class="p">,</span><span class="w"> </span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="nc">MyApp.Endpoint</span><span class="o">.</span><span class="n">unsubscribe</span><span class="p" data-group-id="2290">(</span><span class="s2">&quot;product:</span><span class="si" data-group-id="2289">#{</span><span class="n">id</span><span class="si" data-group-id="2289">}</span><span class="s2">&quot;</span><span class="p" data-group-id="2290">)</span><span class="p" data-group-id="2291">}</span><span class="w">
  </span><span class="k" data-group-id="2292">end</span><span class="w">

  </span><span class="kd">defp</span><span class="w"> </span><span class="nf">put_new_topics</span><span class="p" data-group-id="2301">(</span><span class="n">socket</span><span class="p">,</span><span class="w"> </span><span class="n">topics</span><span class="p" data-group-id="2301">)</span><span class="w"> </span><span class="k" data-group-id="2353">do</span><span class="w">
    </span><span class="nc">Enum</span><span class="o">.</span><span class="n">reduce</span><span class="p" data-group-id="2351">(</span><span class="n">topics</span><span class="p">,</span><span class="w"> </span><span class="n">socket</span><span class="p">,</span><span class="w"> </span><span class="k" data-group-id="2350">fn</span><span class="w"> </span><span class="n">topic</span><span class="p">,</span><span class="w"> </span><span class="n">acc</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
      </span><span class="n">topics</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">acc</span><span class="o">.</span><span class="n">assigns</span><span class="o">.</span><span class="n">topics</span><span class="w">
      </span><span class="k">if</span><span class="w"> </span><span class="n">topic</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">topics</span><span class="w"> </span><span class="k" data-group-id="2348">do</span><span class="w">
        </span><span class="n">acc</span><span class="w">
      </span><span class="k" data-group-id="2348">else</span><span class="w">
        </span><span class="ss">:ok</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">MyApp.Endpoint</span><span class="o">.</span><span class="n">subscribe</span><span class="p" data-group-id="2336">(</span><span class="n">topic</span><span class="p" data-group-id="2336">)</span><span class="w">
        </span><span class="n">assign</span><span class="p" data-group-id="2345">(</span><span class="n">acc</span><span class="p">,</span><span class="w"> </span><span class="ss">:topics</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2344">[</span><span class="n">topic</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">topics</span><span class="p" data-group-id="2344">]</span><span class="p" data-group-id="2345">)</span><span class="w">
      </span><span class="k" data-group-id="2348">end</span><span class="w">
    </span><span class="k" data-group-id="2350">end</span><span class="p" data-group-id="2351">)</span><span class="w">
  </span><span class="k" data-group-id="2353">end</span><span class="w">
</span><span class="k" data-group-id="2356">end</span></code></pre>
<p>Note: the caller must be responsible for preventing duplicate subscriptions.
After calling <code class="inline">subscribe/1</code> from your endpoint, the same flow applies to
handling regular Elixir messages within your channel. Most often, you’ll
simply relay the <code class="inline">%Phoenix.Socket.Broadcast{}</code> event and payload:</p>
<pre><code class="nohighlight makeup"><span class="kn">alias</span><span class="w"> </span><span class="nc">Phoenix.Socket.Broadcast</span><span class="w">
</span><span class="kd">def</span><span class="w"> </span><span class="nf">handle_info</span><span class="p" data-group-id="2006">(</span><span class="p" data-group-id="1995">%</span><span class="nc" data-group-id="1995">Broadcast</span><span class="p" data-group-id="1995">{</span><span class="ss">topic</span><span class="p">:</span><span class="w"> </span><span class="bp">_</span><span class="p">,</span><span class="w"> </span><span class="ss">event</span><span class="p">:</span><span class="w"> </span><span class="n">ev</span><span class="p">,</span><span class="w"> </span><span class="ss">payload</span><span class="p">:</span><span class="w"> </span><span class="n">payload</span><span class="p" data-group-id="1995">}</span><span class="p">,</span><span class="w"> </span><span class="n">socket</span><span class="p" data-group-id="2006">)</span><span class="w"> </span><span class="k" data-group-id="2060">do</span><span class="w">
  </span><span class="n">push</span><span class="w"> </span><span class="n">socket</span><span class="p">,</span><span class="w"> </span><span class="n">ev</span><span class="p">,</span><span class="w"> </span><span class="n">payload</span><span class="w">
  </span><span class="p" data-group-id="2054">{</span><span class="ss">:noreply</span><span class="p">,</span><span class="w"> </span><span class="n">socket</span><span class="p" data-group-id="2054">}</span><span class="w">
</span><span class="k" data-group-id="2060">end</span></code></pre>
<h2 id="module-logging" class="section-heading">
  <a href="#module-logging" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Logging
</h2>

<p>By default, channel <code class="inline">&quot;join&quot;</code> and <code class="inline">&quot;handle_in&quot;</code> events are logged, using
the level <code class="inline">:info</code> and <code class="inline">:debug</code>, respectively. Logs can be customized per
event type or disabled by setting the <code class="inline">:log_join</code> and <code class="inline">:log_handle_in</code>
options when using <a href="Phoenix.Channel.html#content"><code class="inline">Phoenix.Channel</code></a>. For example, the following
configuration logs join events as <code class="inline">:info</code>, but disables logging for
incoming events:</p>
<pre><code class="nohighlight makeup"><span class="kn">use</span><span class="w"> </span><span class="nc">Phoenix.Channel</span><span class="p">,</span><span class="w"> </span><span class="ss">log_join</span><span class="p">:</span><span class="w"> </span><span class="ss">:info</span><span class="p">,</span><span class="w"> </span><span class="ss">log_handle_in</span><span class="p">:</span><span class="w"> </span><span class="no">false</span></code></pre>

        </section>
      

      
        <section id="summary" class="details-list">
          <h1 class="section-heading">
            <a class="hover-link" href="#summary">
              <span class="icon-link" aria-hidden="true"></span>
              <span class="sr-only">Link to this section</span>
            </a>
            Summary
          </h1>
          
  <div class="summary-types summary">
    <h2>
      <a href="#types">Types</a>
    </h2>
    <div class="summary-row">
  <div class="summary-signature">
    <a href="#t:reply/0">reply()</a>
  </div>
  
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#t:socket_ref/0">socket_ref()</a>
  </div>
  
</div>

  </div>


          
  <div class="summary-functions summary">
    <h2>
      <a href="#functions">Functions</a>
    </h2>
    <div class="summary-row">
  <div class="summary-signature">
    <a href="#broadcast/3">broadcast(socket, event, message)</a>
  </div>
  
    <div class="summary-synopsis"><p>Broadcast an event to all subscribers of the socket topic</p>
</div>
  
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#broadcast!/3">broadcast!(socket, event, message)</a>
  </div>
  
    <div class="summary-synopsis"><p>Same as <a href="#broadcast/3"><code class="inline">broadcast/3</code></a>, but raises if broadcast fails</p>
</div>
  
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#broadcast_from/3">broadcast_from(socket, event, message)</a>
  </div>
  
    <div class="summary-synopsis"><p>Broadcast event from pid to all subscribers of the socket topic</p>
</div>
  
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#broadcast_from!/3">broadcast_from!(socket, event, message)</a>
  </div>
  
    <div class="summary-synopsis"><p>Same as <a href="#broadcast_from/3"><code class="inline">broadcast_from/3</code></a>, but raises if broadcast fails</p>
</div>
  
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#intercept/1">intercept(events)</a>
  </div>
  
    <div class="summary-synopsis"><p>Defines which Channel events to intercept for <code class="inline">handle_out/3</code> callbacks</p>
</div>
  
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#push/3">push(socket, event, message)</a>
  </div>
  
    <div class="summary-synopsis"><p>Sends event to the socket</p>
</div>
  
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#reply/2">reply(arg1, arg2)</a>
  </div>
  
    <div class="summary-synopsis"><p>Replies asynchronously to a socket push</p>
</div>
  
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#socket_ref/1">socket_ref(socket)</a>
  </div>
  
    <div class="summary-synopsis"><p>Generates a <code class="inline">socket_ref</code> for an async reply</p>
</div>
  
</div>

  </div>


          
  <div class="summary-callbacks summary">
    <h2>
      <a href="#callbacks">Callbacks</a>
    </h2>
    <div class="summary-row">
  <div class="summary-signature">
    <a href="#c:code_change/3">code_change(old_vsn, arg1, extra)</a>
  </div>
  
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#c:handle_in/3">handle_in(event, msg, arg2)</a>
  </div>
  
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#c:handle_info/2">handle_info(term, arg1)</a>
  </div>
  
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#c:join/3">join(topic, auth_msg, arg2)</a>
  </div>
  
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#c:terminate/2">terminate(msg, arg1)</a>
  </div>
  
</div>

  </div>


        </section>
      

      
        <section id="types" class="details-list">
          <h1 class="section-heading">
            <a class="hover-link" href="#types">
              <span class="icon-link" aria-hidden="true"></span>
              <span class="sr-only">Link to this section</span>
            </a>
            Types
          </h1>
          <div class="types-list">
            <div class="detail" id="t:reply/0">
  
  
  <div class="detail-header">
    <a href="#t:reply/0" class="detail-link" title="Link to this type">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this type</span>
    </a>
    <span class="signature">reply()</span>
    
      <a href="https://github.com/phoenixframework/phoenix/blob/v1.4.0-dev/lib/phoenix/channel.ex#L266" class="view-source" rel="help" title="View Source">
       <span class="icon-code" aria-hidden="true"></span>
       <span class="sr-only">View Source</span>
     </a>
    
    
    
      <div class="specs">
        
          <pre>reply() :: status :: atom() | {status :: atom(), response :: map()}</pre>
        
      </div>
    
  </div>
  <section class="docstring">
    
  </section>
</div>
<div class="detail" id="t:socket_ref/0">
  
  
  <div class="detail-header">
    <a href="#t:socket_ref/0" class="detail-link" title="Link to this type">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this type</span>
    </a>
    <span class="signature">socket_ref()</span>
    
      <a href="https://github.com/phoenixframework/phoenix/blob/v1.4.0-dev/lib/phoenix/channel.ex#L267" class="view-source" rel="help" title="View Source">
       <span class="icon-code" aria-hidden="true"></span>
       <span class="sr-only">View Source</span>
     </a>
    
    
    
      <div class="specs">
        
          <pre>socket_ref() :: {transport_pid :: Pid, serializer :: module(), topic :: binary(), ref :: binary(), join_ref :: binary()}</pre>
        
      </div>
    
  </div>
  <section class="docstring">
    
  </section>
</div>

          </div>
        </section>
      

      
        <section id="functions" class="details-list">
          <h1 class="section-heading">
            <a class="hover-link" href="#functions">
              <span class="icon-link" aria-hidden="true"></span>
              <span class="sr-only">Link to this section</span>
            </a>
            Functions
          </h1>
          <div class="detail" id="broadcast/3">
  
  
  <div class="detail-header">
    <a href="#broadcast/3" class="detail-link" title="Link to this function">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this function</span>
    </a>
    <span class="signature">broadcast(socket, event, message)</span>
    
      <a href="https://github.com/phoenixframework/phoenix/blob/v1.4.0-dev/lib/phoenix/channel.ex#L393" class="view-source" rel="help" title="View Source">
       <span class="icon-code" aria-hidden="true"></span>
       <span class="sr-only">View Source</span>
     </a>
    
    
    
  </div>
  <section class="docstring">
    <p>Broadcast an event to all subscribers of the socket topic.</p>
<p>The event’s message must be a serializable map.</p>
<h2 id="broadcast/3-examples" class="section-heading">
  <a href="#broadcast/3-examples" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Examples
</h2>

<pre><code class="nohighlight makeup"><span class="gp">iex&gt;</span><span class="w"> </span><span class="n">broadcast</span><span class="w"> </span><span class="n">socket</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;new_message&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2388">%{</span><span class="ss">id</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">content</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;hello&quot;</span><span class="p" data-group-id="2388">}</span><span class="w">
</span><span class="ss">:ok</span></code></pre>

  </section>
</div>
<div class="detail" id="broadcast!/3">
  
  
  <div class="detail-header">
    <a href="#broadcast!/3" class="detail-link" title="Link to this function">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this function</span>
    </a>
    <span class="signature">broadcast!(socket, event, message)</span>
    
      <a href="https://github.com/phoenixframework/phoenix/blob/v1.4.0-dev/lib/phoenix/channel.ex#L401" class="view-source" rel="help" title="View Source">
       <span class="icon-code" aria-hidden="true"></span>
       <span class="sr-only">View Source</span>
     </a>
    
    
    
  </div>
  <section class="docstring">
    <p>Same as <a href="#broadcast/3"><code class="inline">broadcast/3</code></a>, but raises if broadcast fails.</p>

  </section>
</div>
<div class="detail" id="broadcast_from/3">
  
  
  <div class="detail-header">
    <a href="#broadcast_from/3" class="detail-link" title="Link to this function">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this function</span>
    </a>
    <span class="signature">broadcast_from(socket, event, message)</span>
    
      <a href="https://github.com/phoenixframework/phoenix/blob/v1.4.0-dev/lib/phoenix/channel.ex#L418" class="view-source" rel="help" title="View Source">
       <span class="icon-code" aria-hidden="true"></span>
       <span class="sr-only">View Source</span>
     </a>
    
    
    
  </div>
  <section class="docstring">
    <p>Broadcast event from pid to all subscribers of the socket topic.</p>
<p>The channel that owns the socket will not receive the published
message. The event’s message must be a serializable map.</p>
<h2 id="broadcast_from/3-examples" class="section-heading">
  <a href="#broadcast_from/3-examples" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Examples
</h2>

<pre><code class="nohighlight makeup"><span class="gp">iex&gt;</span><span class="w"> </span><span class="n">broadcast_from</span><span class="w"> </span><span class="n">socket</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;new_message&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2399">%{</span><span class="ss">id</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">content</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;hello&quot;</span><span class="p" data-group-id="2399">}</span><span class="w">
</span><span class="ss">:ok</span></code></pre>

  </section>
</div>
<div class="detail" id="broadcast_from!/3">
  
  
  <div class="detail-header">
    <a href="#broadcast_from!/3" class="detail-link" title="Link to this function">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this function</span>
    </a>
    <span class="signature">broadcast_from!(socket, event, message)</span>
    
      <a href="https://github.com/phoenixframework/phoenix/blob/v1.4.0-dev/lib/phoenix/channel.ex#L426" class="view-source" rel="help" title="View Source">
       <span class="icon-code" aria-hidden="true"></span>
       <span class="sr-only">View Source</span>
     </a>
    
    
    
  </div>
  <section class="docstring">
    <p>Same as <a href="#broadcast_from/3"><code class="inline">broadcast_from/3</code></a>, but raises if broadcast fails.</p>

  </section>
</div>
<div class="detail" id="intercept/1">
  
  
  <div class="detail-header">
    <a href="#intercept/1" class="detail-link" title="Link to this macro">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this macro</span>
    </a>
    <span class="signature">intercept(events)</span>
    
      <a href="https://github.com/phoenixframework/phoenix/blob/v1.4.0-dev/lib/phoenix/channel.ex#L363" class="view-source" rel="help" title="View Source">
       <span class="icon-code" aria-hidden="true"></span>
       <span class="sr-only">View Source</span>
     </a>
    
    
      <span class="note">(macro)</span>
    
    
  </div>
  <section class="docstring">
    <p>Defines which Channel events to intercept for <code class="inline">handle_out/3</code> callbacks.</p>
<p>By default, broadcasted events are pushed directly to the client, but
intercepting events gives your channel a chance to customize the event
for the client to append extra information or filter the message from being
delivered.</p>
<p><em>Note</em>: intercepting events can introduce significantly more overhead if a
large number of subscribers must customize a message since the broadcast will
be encoded N times instead of a single shared encoding across all subscribers.</p>
<h2 id="intercept/1-examples" class="section-heading">
  <a href="#intercept/1-examples" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Examples
</h2>

<pre><code class="nohighlight makeup"><span class="n">intercept</span><span class="w"> </span><span class="p" data-group-id="2406">[</span><span class="s2">&quot;new_msg&quot;</span><span class="p" data-group-id="2406">]</span><span class="w">

</span><span class="kd">def</span><span class="w"> </span><span class="nf">handle_out</span><span class="p" data-group-id="2413">(</span><span class="s2">&quot;new_msg&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">payload</span><span class="p">,</span><span class="w"> </span><span class="n">socket</span><span class="p" data-group-id="2413">)</span><span class="w"> </span><span class="k" data-group-id="2429">do</span><span class="w">
  </span><span class="n">push</span><span class="w"> </span><span class="n">socket</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;new_msg&quot;</span><span class="p">,</span><span class="w"> </span><span class="nc">Map</span><span class="o">.</span><span class="n">merge</span><span class="p" data-group-id="2426">(</span><span class="n">payload</span><span class="p">,</span><span class="w">
    </span><span class="ss">is_editable</span><span class="p">:</span><span class="w"> </span><span class="nc">User</span><span class="o">.</span><span class="n">can_edit_message?</span><span class="p" data-group-id="2425">(</span><span class="n">socket</span><span class="o">.</span><span class="n">assigns</span><span class="p" data-group-id="2424">[</span><span class="ss">:user</span><span class="p" data-group-id="2424">]</span><span class="p">,</span><span class="w"> </span><span class="n">payload</span><span class="p" data-group-id="2425">)</span><span class="w">
  </span><span class="p" data-group-id="2426">)</span><span class="w">
  </span><span class="p" data-group-id="2428">{</span><span class="ss">:noreply</span><span class="p">,</span><span class="w"> </span><span class="n">socket</span><span class="p" data-group-id="2428">}</span><span class="w">
</span><span class="k" data-group-id="2429">end</span></code></pre>
<p><code class="inline">handle_out/3</code> callbacks must return one of:</p>
<pre><code class="nohighlight makeup"><span class="p" data-group-id="2408">{</span><span class="ss">:noreply</span><span class="p">,</span><span class="w"> </span><span class="nc">Socket</span><span class="o">.</span><span class="n">t</span><span class="p" data-group-id="2408">}</span><span class="w"> </span><span class="o">|</span><span class="w">
</span><span class="p" data-group-id="2414">{</span><span class="ss">:stop</span><span class="p">,</span><span class="w"> </span><span class="n">reason</span><span class="w"> </span><span class="o">::</span><span class="w"> </span><span class="n">term</span><span class="p">,</span><span class="w"> </span><span class="nc">Socket</span><span class="o">.</span><span class="n">t</span><span class="p" data-group-id="2414">}</span></code></pre>

  </section>
</div>
<div class="detail" id="push/3">
  
  
  <div class="detail-header">
    <a href="#push/3" class="detail-link" title="Link to this function">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this function</span>
    </a>
    <span class="signature">push(socket, event, message)</span>
    
      <a href="https://github.com/phoenixframework/phoenix/blob/v1.4.0-dev/lib/phoenix/channel.ex#L442" class="view-source" rel="help" title="View Source">
       <span class="icon-code" aria-hidden="true"></span>
       <span class="sr-only">View Source</span>
     </a>
    
    
    
  </div>
  <section class="docstring">
    <p>Sends event to the socket.</p>
<p>The event’s message must be a serializable map.</p>
<h2 id="push/3-examples" class="section-heading">
  <a href="#push/3-examples" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Examples
</h2>

<pre><code class="nohighlight makeup"><span class="gp">iex&gt;</span><span class="w"> </span><span class="n">push</span><span class="w"> </span><span class="n">socket</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;new_message&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2437">%{</span><span class="ss">id</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">content</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;hello&quot;</span><span class="p" data-group-id="2437">}</span><span class="w">
</span><span class="ss">:ok</span></code></pre>

  </section>
</div>
<div class="detail" id="reply/2">
  
  
  <div class="detail-header">
    <a href="#reply/2" class="detail-link" title="Link to this function">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this function</span>
    </a>
    <span class="signature">reply(arg1, arg2)</span>
    
      <a href="https://github.com/phoenixframework/phoenix/blob/v1.4.0-dev/lib/phoenix/channel.ex#L476" class="view-source" rel="help" title="View Source">
       <span class="icon-code" aria-hidden="true"></span>
       <span class="sr-only">View Source</span>
     </a>
    
    
    
      <div class="specs">
        
          <pre>reply(<a href="#t:socket_ref/0">socket_ref</a>(), <a href="#t:reply/0">reply</a>()) :: :ok</pre>
        
      </div>
    
  </div>
  <section class="docstring">
    <p>Replies asynchronously to a socket push.</p>
<p>Useful when you need to reply to a push that can’t otherwise be handled using
the <code class="inline">{:reply, {status, payload}, socket}</code> return from your <code class="inline">handle_in</code>
callbacks. <a href="#reply/2"><code class="inline">reply/2</code></a> will be used in the rare cases you need to perform work in
another process and reply when finished by generating a reference to the push
with <a href="#socket_ref/1"><code class="inline">socket_ref/1</code></a>.</p>
<p><em>Note</em>: In such cases, a <code class="inline">socket_ref</code> should be generated and
passed to the external process, so the <code class="inline">socket</code> itself is not leaked outside
the channel. The <code class="inline">socket</code> holds information such as assigns and transport
configuration, so it’s important to not copy this information outside of the
channel that owns it.</p>
<h2 id="reply/2-examples" class="section-heading">
  <a href="#reply/2-examples" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Examples
</h2>

<pre><code class="nohighlight makeup"><span class="kd">def</span><span class="w"> </span><span class="nf">handle_in</span><span class="p" data-group-id="2444">(</span><span class="s2">&quot;work&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">payload</span><span class="p">,</span><span class="w"> </span><span class="n">socket</span><span class="p" data-group-id="2444">)</span><span class="w"> </span><span class="k" data-group-id="2450">do</span><span class="w">
  </span><span class="nc">Worker</span><span class="o">.</span><span class="n">perform</span><span class="p" data-group-id="2448">(</span><span class="n">payload</span><span class="p">,</span><span class="w"> </span><span class="n">socket_ref</span><span class="p" data-group-id="2447">(</span><span class="n">socket</span><span class="p" data-group-id="2447">)</span><span class="p" data-group-id="2448">)</span><span class="w">
  </span><span class="p" data-group-id="2449">{</span><span class="ss">:noreply</span><span class="p">,</span><span class="w"> </span><span class="n">socket</span><span class="p" data-group-id="2449">}</span><span class="w">
</span><span class="k" data-group-id="2450">end</span><span class="w">

</span><span class="kd">def</span><span class="w"> </span><span class="nf">handle_info</span><span class="p" data-group-id="2457">(</span><span class="p" data-group-id="2456">{</span><span class="ss">:work_complete</span><span class="p">,</span><span class="w"> </span><span class="n">result</span><span class="p">,</span><span class="w"> </span><span class="n">ref</span><span class="p" data-group-id="2456">}</span><span class="p">,</span><span class="w"> </span><span class="n">socket</span><span class="p" data-group-id="2457">)</span><span class="w"> </span><span class="k" data-group-id="2462">do</span><span class="w">
  </span><span class="n">reply</span><span class="w"> </span><span class="n">ref</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2460">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="n">result</span><span class="p" data-group-id="2460">}</span><span class="w">
  </span><span class="p" data-group-id="2461">{</span><span class="ss">:noreply</span><span class="p">,</span><span class="w"> </span><span class="n">socket</span><span class="p" data-group-id="2461">}</span><span class="w">
</span><span class="k" data-group-id="2462">end</span></code></pre>

  </section>
</div>
<div class="detail" id="socket_ref/1">
  
  
  <div class="detail-header">
    <a href="#socket_ref/1" class="detail-link" title="Link to this function">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this function</span>
    </a>
    <span class="signature">socket_ref(socket)</span>
    
      <a href="https://github.com/phoenixframework/phoenix/blob/v1.4.0-dev/lib/phoenix/channel.ex#L489" class="view-source" rel="help" title="View Source">
       <span class="icon-code" aria-hidden="true"></span>
       <span class="sr-only">View Source</span>
     </a>
    
    
    
      <div class="specs">
        
          <pre>socket_ref(<a href="Phoenix.Socket.html#t:t/0">Phoenix.Socket.t</a>()) :: <a href="#t:socket_ref/0">socket_ref</a>()</pre>
        
      </div>
    
  </div>
  <section class="docstring">
    <p>Generates a <code class="inline">socket_ref</code> for an async reply.</p>
<p>See <a href="#reply/2"><code class="inline">reply/2</code></a> for example usage.</p>

  </section>
</div>

        </section>
      

      
        <section id="callbacks" class="details-list">
          <h1 class="section-heading">
            <a class="hover-link" href="#callbacks">
              <span class="icon-link" aria-hidden="true"></span>
              <span class="sr-only">Link to this section</span>
            </a>
            Callbacks
          </h1>
          <div class="detail" id="c:code_change/3">
  
  
  <div class="detail-header">
    <a href="#c:code_change/3" class="detail-link" title="Link to this callback">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this callback</span>
    </a>
    <span class="signature">code_change(old_vsn, arg1, extra)</span>
    
      <a href="https://github.com/phoenixframework/phoenix/blob/v1.4.0-dev/lib/phoenix/channel.ex#L271" class="view-source" rel="help" title="View Source">
       <span class="icon-code" aria-hidden="true"></span>
       <span class="sr-only">View Source</span>
     </a>
    
    
    
      <div class="specs">
        
          <pre>code_change(old_vsn, <a href="Phoenix.Socket.html#t:t/0">Phoenix.Socket.t</a>(), extra :: term()) ::
  {:ok, <a href="Phoenix.Socket.html#t:t/0">Phoenix.Socket.t</a>()} |
  {:error, reason :: term()} when old_vsn: term() | {:down, term()}</pre>
        
      </div>
    
  </div>
  <section class="docstring">
    
  </section>
</div>
<div class="detail" id="c:handle_in/3">
  
  
  <div class="detail-header">
    <a href="#c:handle_in/3" class="detail-link" title="Link to this callback">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this callback</span>
    </a>
    <span class="signature">handle_in(event, msg, arg2)</span>
    
      <a href="https://github.com/phoenixframework/phoenix/blob/v1.4.0-dev/lib/phoenix/channel.ex#L280" class="view-source" rel="help" title="View Source">
       <span class="icon-code" aria-hidden="true"></span>
       <span class="sr-only">View Source</span>
     </a>
    
    
    
      <div class="specs">
        
          <pre>handle_in(event :: <a href="https://hexdocs.pm/elixir/String.html#t:t/0">String.t</a>(), msg :: map(), <a href="Phoenix.Socket.html#t:t/0">Phoenix.Socket.t</a>()) ::
  {:noreply, <a href="Phoenix.Socket.html#t:t/0">Phoenix.Socket.t</a>()} |
  {:reply, <a href="#t:reply/0">reply</a>(), <a href="Phoenix.Socket.html#t:t/0">Phoenix.Socket.t</a>()} |
  {:stop, reason :: term(), <a href="Phoenix.Socket.html#t:t/0">Phoenix.Socket.t</a>()} |
  {:stop, reason :: term(), <a href="#t:reply/0">reply</a>(), <a href="Phoenix.Socket.html#t:t/0">Phoenix.Socket.t</a>()}</pre>
        
      </div>
    
  </div>
  <section class="docstring">
    
  </section>
</div>
<div class="detail" id="c:handle_info/2">
  
  
  <div class="detail-header">
    <a href="#c:handle_info/2" class="detail-link" title="Link to this callback">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this callback</span>
    </a>
    <span class="signature">handle_info(term, arg1)</span>
    
      <a href="https://github.com/phoenixframework/phoenix/blob/v1.4.0-dev/lib/phoenix/channel.ex#L286" class="view-source" rel="help" title="View Source">
       <span class="icon-code" aria-hidden="true"></span>
       <span class="sr-only">View Source</span>
     </a>
    
    
    
      <div class="specs">
        
          <pre>handle_info(term(), <a href="Phoenix.Socket.html#t:t/0">Phoenix.Socket.t</a>()) ::
  {:noreply, <a href="Phoenix.Socket.html#t:t/0">Phoenix.Socket.t</a>()} |
  {:stop, reason :: term(), <a href="Phoenix.Socket.html#t:t/0">Phoenix.Socket.t</a>()}</pre>
        
      </div>
    
  </div>
  <section class="docstring">
    
  </section>
</div>
<div class="detail" id="c:join/3">
  
  
  <div class="detail-header">
    <a href="#c:join/3" class="detail-link" title="Link to this callback">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this callback</span>
    </a>
    <span class="signature">join(topic, auth_msg, arg2)</span>
    
      <a href="https://github.com/phoenixframework/phoenix/blob/v1.4.0-dev/lib/phoenix/channel.ex#L275" class="view-source" rel="help" title="View Source">
       <span class="icon-code" aria-hidden="true"></span>
       <span class="sr-only">View Source</span>
     </a>
    
    
    
      <div class="specs">
        
          <pre>join(topic :: binary(), auth_msg :: map(), <a href="Phoenix.Socket.html#t:t/0">Phoenix.Socket.t</a>()) ::
  {:ok, <a href="Phoenix.Socket.html#t:t/0">Phoenix.Socket.t</a>()} |
  {:ok, map(), <a href="Phoenix.Socket.html#t:t/0">Phoenix.Socket.t</a>()} |
  {:error, map()}</pre>
        
      </div>
    
  </div>
  <section class="docstring">
    
  </section>
</div>
<div class="detail" id="c:terminate/2">
  
  
  <div class="detail-header">
    <a href="#c:terminate/2" class="detail-link" title="Link to this callback">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this callback</span>
    </a>
    <span class="signature">terminate(msg, arg1)</span>
    
      <a href="https://github.com/phoenixframework/phoenix/blob/v1.4.0-dev/lib/phoenix/channel.ex#L290" class="view-source" rel="help" title="View Source">
       <span class="icon-code" aria-hidden="true"></span>
       <span class="sr-only">View Source</span>
     </a>
    
    
    
      <div class="specs">
        
          <pre>terminate(msg :: map(), <a href="Phoenix.Socket.html#t:t/0">Phoenix.Socket.t</a>()) ::
  {:shutdown, :left | :closed} |
  term()</pre>
        
      </div>
    
  </div>
  <section class="docstring">
    
  </section>
</div>

        </section>
      
          <footer class="footer">
        <p>
          <span class="line">
            Built using
            <a href="https://github.com/elixir-lang/ex_doc" title="ExDoc" rel="help" target="_blank">ExDoc</a> (v0.18.1),
          </span>
          <span class="line">
            designed by
            <a href="https://twitter.com/dignifiedquire" target="_blank" title="@dignifiedquire">Friedel Ziegelmayer</a>.
            </span>
        </p>
        <button class="night-mode-toggle"><span class="sr-only">Switch theme</span></button>
      </footer>
    </div>
  </div>
</section>
</div>
  <script src="dist/app-778c9ef903.js"></script>
  
  <script src="dist/ex_doc_makeup-js.js"></script>
  
  
  </body>
</html>

